<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Markmap Integration For Logseq</title>
  <script defer src="https://unpkg.com/alpinejs@3.2.3/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
  <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>

</head>
<body x-data="{ theme: '', manual: false, front: 'text-gray-900', bg: 'bg-gray-100', showHelp: false }" x-init="theme = JSON.parse(localStorage.getItem('theme')); "  class="relative" :class="!manual && theme === 'dark' ? 'dark' : '' ">
  <div class="h-screen dark:bg-gray-900 dark:text-gray-50 bg-opacity-90 dark:bg-opacity-90 backdrop-blur-sm items-center justify-center flex w-full" :class="{[front]: true, [bg]: true}" id="markmap-container">
    <svg class="w-11/12 h-5/6" id="markmap"></svg>

    <div x-data="{
      themeList: {
        'bg-gray-100': 'text-gray-900',
        'bg-red-100': 'text-red-900',
        'bg-blue-100': 'text-blue-900',
        'bg-green-100': 'text-green-900',
        'bg-yellow-100': 'text-yellow-900',
        'bg-purple-100': 'text-purple-900',
        'bg-pink-100': 'text-pink-900',
        'bg-indigo-100': 'text-indigo-900',
        'bg-indigo-900': 'text-indigo-100',
        'bg-pink-900': 'text-pink-100',
        'bg-purple-900': 'text-purple-100',
        'bg-yellow-900': 'text-yellow-100',
        'bg-green-900': 'text-green-100',
        'bg-blue-900': 'text-blue-100',
        'bg-red-900': 'text-red-100',
        'bg-gray-900': 'text-gray-100',
      }

    }" class="absolute bottom-4 w-full flex items-center justify-center opacity-0 hover:opacity-100">
      <div class="flex flex-row gap-2 w-auto">
        <div x-data title="Random">
          <svg id="random-button" @click="manual = true; bg = Object.keys(themeList)[Math.floor(Math.random() * Object.keys(themeList).length)]; front = themeList[bg]" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 cursor-pointer" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
          </svg>
        </div>
        <div title="Light gray"  @click="manual = true; bg = 'bg-gray-100'; front = themeList[bg]" class="w-4 h-4 bg-gray-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light red"  @click="manual = true; bg = 'bg-red-100'; front = themeList[bg]" class="w-4 h-4 bg-red-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light blue"  @click="manual = true; bg = 'bg-blue-100'; front = themeList[bg]" class="w-4 h-4 bg-blue-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light green" @click="manual = true; bg = 'bg-green-100'; front = themeList[bg]" class="w-4 h-4 bg-green-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light yellow" @click="manual = true; bg = 'bg-yellow-100'; front = themeList[bg]" class="w-4 h-4 bg-yellow-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light pink" @click="manual = true; bg = 'bg-pink-100'; front = themeList[bg]" class="w-4 h-4 bg-purple-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light purple" @click="manual = true; bg = 'bg-purple-100'; front = themeList[bg]" class="w-4 h-4 bg-pink-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Light indigo" @click="manual = true; bg = 'bg-indigo-100'; front = themeList[bg]" class="w-4 h-4 bg-indigo-200 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark indigo" @click="manual = true; bg = 'bg-indigo-900'; front = themeList[bg]" class="w-4 h-4 bg-indigo-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark purple" @click="manual = true; bg = 'bg-purple-900'; front = themeList[bg]" class="w-4 h-4 bg-pink-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark pink" @click="manual = true; bg = 'bg-pink-900'; front = themeList[bg]" class="w-4 h-4 bg-purple-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark yellow" @click="manual = true; bg = 'bg-yellow-900'; front = themeList[bg]" class="w-4 h-4 bg-yellow-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark green" @click="manual = true; bg = 'bg-green-900'; front = themeList[bg]" class="w-4 h-4 bg-green-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark blue" @click="manual = true; bg = 'bg-blue-900'; front = themeList[bg]" class="w-4 h-4 bg-blue-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark red" @click="manual = true; bg = 'bg-red-900'; front = themeList[bg]" class="w-4 h-4 bg-red-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Dark gray" @click="manual = true; bg = 'bg-gray-900'; front = themeList[bg]" class="w-4 h-4 bg-gray-700 rounded-full shadow-2xl cursor-pointer"></div>
        <div title="Reset">
          <svg id="reset-button" @click="manual = false; theme = JSON.parse(localStorage.getItem('theme')); front = 'text-gray-900'; bg = 'bg-gray-100'" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 cursor-pointer" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    </div>
  </div>
  <div id="markmap-toolbar" class="cursor-pointer dark:text-gray-50" :class="bg.indexOf('900') > -1 ? 'text-gray-50' : 'text-gray-900'"></div>

  <div id="help-modal" class="modal fixed w-full h-full top-0 left-0 flex items-center justify-center z-50" :class="$store.showHelp.on ? '' : 'opacity-0 hidden'">
    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-95"></div>

    <div class="modal-container bg-white w-11/12 md:max-w-xl mx-auto rounded shadow-lg z-40 overflow-y-auto">
      <!-- Add margin if you want to see some of the overlay behind the modal-->
      <div class="modal-content py-4 text-left px-6">
        <!--Title-->
        <div class="flex justify-between items-center pb-3">
          <p class="text-2xl font-bold">Key bindings</p>
          <div @click="showHelp = false" class="modal-close cursor-pointer z-50">
            <svg @click="$store.showHelp.on = false;"  class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
              <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
            </svg>
          </div>
        </div>

        <div class="mb-2 text-gray-900">Using shortcuts, you can fine-grained control the mindmap.</div>

        <table class="border-collapse border border-blue-900 text-sm leading-relaxed text-gray-900 w-full ">
          <tr>
            <th class="border border-blue-900 text-center w-24">Key</th>
            <th class="border border-blue-900 text-center">Description</th>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">SPACE</td>
            <td class="pl-2 border border-blue-900">Fit window in center in case you move or zoom it.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">0</td>
            <td class="pl-2 border border-blue-900">Hide all except the central one.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">9</td>
            <td class="pl-2 border border-blue-900">Show all.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">1</td>
            <td class="pl-2 border border-blue-900">Expand to level 1.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">2</td>
            <td class="pl-2 border border-blue-900">Expand to level 2.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">3</td>
            <td class="pl-2 border border-blue-900">Expand to level 3.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">4</td>
            <td class="pl-2 border border-blue-900">Expand to level 4.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">5</td>
            <td class="pl-2 border border-blue-900">Expand to level 5.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">+</td>
            <td class="pl-2 border border-blue-900">Zoom in.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">-</td>
            <td class="pl-2 border border-blue-900">Zoom out.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">h</td>
            <td class="pl-2 border border-blue-900">Level up.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">l</td>
            <td class="pl-2 border border-blue-900">Level down.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">j</td>
            <td class="pl-2 border border-blue-900">Expand step by step.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">k</td>
            <td class="pl-2 border border-blue-900">Collapse step by step.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">UP</td>
            <td class="pl-2 border border-blue-900">Move mindmap up.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">DOWN</td>
            <td class="pl-2 border border-blue-900">Move mindmap down.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">LEFT</td>
            <td class="pl-2 border border-blue-900">Move mindmap left.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">RIGHT</td>
            <td class="pl-2 border border-blue-900">Move mindmap right.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">.</td>
            <td class="pl-2 border border-blue-900">Focus into child level.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">b</td>
            <td class="pl-2 border border-blue-900">Focus out to parent level.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">,</td>
            <td class="pl-2 border border-blue-900">Reset to original tree.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">n</td>
            <td class="pl-2 border border-blue-900">Focus to next sibling.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">p</td>
            <td class="pl-2 border border-blue-900">Focus to previous sibling.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">r</td>
            <td class="pl-2 border border-blue-900">Random change theme.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">z</td>
            <td class="pl-2 border border-blue-900">Reset theme according to Logseq theme.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">ESC & q</td>
            <td class="pl-2 border border-blue-900">Close the mindmap.</td>
          </tr>
          <tr>
            <td class="pl-2 border border-blue-900">/</td>
            <td class="pl-2 border border-blue-900">Toggle this modal.</td>
          </tr>

        </table>

      </div>
    </div>
  </div>
  <script>
    document.addEventListener('alpine:init', () => {
        // Alpine.store('showHelp', false)

        Alpine.store('showHelp', {
            init() {
                this.on = false
            },

            on: false,

            toggle() {
                this.on = ! this.on
            },

            close() {
              this.on = false
            },

            open() {
              this.on = true
            },

            get() {
              return this.on
            }
        })
    })
</script>
</body>
</html>
